<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MT-SITE</title>
    <!-- axios cdn -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- bootstrap CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- modals -->
    <!-- model login -->
    <div
      class="modal fade"
      id="loginModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Login</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="recipient-name" class="col-form-label"
                  >Username:</label
                >
                <input type="email" class="form-control" id="usernameInput" />
              </div>
              <div class="mb-3">
                <label for="message-text" class="col-form-label"
                  >password:</label
                >
                <input
                  type="password"
                  class="form-control"
                  id="passwordInput"
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button id="loginbtn" type="button" class="btn btn-primary">
              login
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- modal register  -->
    <div
      class="modal fade"
      id="registerModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Register</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="recipient-name" class="col-form-label">Name:</label>
                <input
                  type="text"
                  class="form-control"
                  id="RegisterNameInput"
                />
              </div>
              <div class="mb-3">
                <label for="recipient-name" class="col-form-label"
                  >Username:</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="RegisterUsernameInput"
                />
              </div>
              <div class="mb-3">
                <label for="recipient-name" class="col-form-label"
                  >email:</label
                >
                <input
                  type="email"
                  class="form-control"
                  id="RegisterEmailInput"
                />
              </div>
              <div class="mb-3">
                <label for="message-text" class="col-form-label"
                  >password:</label
                >
                <input
                  type="password"
                  class="form-control"
                  id="RegisterPasswordInput"
                />
              </div>
              <div class="mb-3">
                <label for="Register-Image" class="col-form-label"
                  >Image:</label
                >
                <input
                  type="file"
                  class="form-control"
                  id="Register-Image-Input"
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              id="loginbtn"
              type="button"
              class="btn btn-primary"
              onclick="registerBtnClicked()"
            >
              Register
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="container mt-4 d-flex justify-content-center">
      <nav
        class="navbar shadow-lg navbar-expand-lg navbar-light bg-light col-9"
      >
        <div class="container-fluid">
          <a class="navbar-brand" id="usernameNav" href="#">MT-chating</a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="index.html"
                  >Home</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Profile</a>
              </li>

              <li class="nav-item">
                <a
                  class="nav-link disabled"
                  href="#"
                  tabindex="-1"
                  aria-disabled="true"
                  >Disabled</a
                >
              </li>
            </ul>
            <form class="d-flex gap-2">
              <div id="profile-image-nav" class="">
                <img
                  id="profile-user"
                  src="https://www.shutterstock.com/image-vector/default-avatar-profile-icon-social-600nw-1677509740.jpg"
                  ;
                  alt=""
                  class="rounded-circle"
                  style="width: 40px; height: 40px"
                />
              </div>
              <button
                type="button"
                id="loginbtnnav"
                class="btn btn-outline-success testingclass"
                data-bs-toggle="modal"
                data-bs-target="#loginModal"
              >
                login
              </button>
              <button
                type="button"
                id="registerbtnnav"
                data-bs-toggle="modal"
                data-bs-target="#registerModal"
                class="btn btn-outline-primary"
              >
                Register
              </button>
              <button
                id="logoutBtnNav"
                class="btn btn-outline-danger"
                type="submit"
                style="visibility: hidden"
              >
                logout
              </button>
            </form>
          </div>
        </div>
      </nav>
    </div>
    <!--/nav barr  -->
    <!-- post -->

    <div id="post" class="container">
      <div class="d-flex justify-content-center mt-3">
        <div class="col-9">
          <div id="postcard">
            <div id="success-alert" class="show fade"></div>
            <div id="" class="show" style="font-size: 1.3rem">
              <span style="" id="namepost"> name`s </span>
              post
            </div>
            <div class="card my-3 shadow-lg">
              <div class="card-header">
                <img
                  class="rounded-circle border border-2"
                  style="width: 40px"
                  height="40px"
                  src="https://st3.depositphotos.com/15648834/17930/v/450/depositphotos_179308454-stock-illustration-unknown-person-silhouette-glasses-profile.jpg"
                  alt=""
                />
                <span class="bold">@userName</span>
              </div>
              <div class="card-body">
                <img
                  class="cover"
                  src="./assests/masjed.jpg"
                  alt=""
                  style="width: 100%"
                  height="350px"
                />
                <h6 class="mt-1">2min ago</h6>
                <h5>Title of the post</h5>
                <p>
                  Lorem, ipsum dolor sit amet consectetur adipisicing elit.
                  Ipsum quos ex laboriosam neque. Temporibus sapiente illum
                  aspernatur incidunt, dolore quam dicta consequatur,
                  consequuntur totam non assumenda ea iusto explicabo id?
                </p>
                <hr />
                <!-- comments section -->
                <div class="CommentHere"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <script src="main.js"></script>
    <script>
      setUpUI();
      const urlParms = new URLSearchParams(window.location.search);
      const postId = urlParms.get("postid");
      getPostData();
      // getPostData();
      function getPostData() {
        axios
          .get(`https://tarmeezacademy.com/api/v1/posts/${postId}`)
          .then(function (response) {
            let author = response.data.data.author;
            console.log(author);
            let posttitle = author.title;
            let username = author.username;
            let name = author.name;
            let profileimg = author.profile_image;
            // handle success
            let postdata = response.data.data;
            console.log(postdata);
            fillCurrentPost(response);
          })
          .catch(function (error) {
            // handle error
            console.log(error);
          });
      }
      function fillCurrentPost(response) {
        responseData = response.data.data;
        let author = responseData.author;
        let comments = responseData.comments;
        let post_image = responseData.image;
        let post_body = responseData.body;
        let post_title = responseData.title;
        let content = `
            <div id="success-alert" class="show fade"></div>
            <div id="" class="show" style="font-size: 1.3rem">
              <span style="" id="namepost"> ${author.name}\`s </span>
              post
            </div>
            <div class="card my-3 shadow-lg">
              <div class="card-header">
                <img
                  class="rounded-circle border border-2"
                  style="width: 40px"
                  height="40px"
                  src='${
                    author.profile_image ||
                    "https://st3.depositphotos.com/15648834/17930/v/450/depositphotos_179308454-stock-illustration-unknown-person-silhouette-glasses-profile.jpg"
                  }'
                  alt=""
                />
                <span class="bold">${author.username}</span>
              </div>
              <div class="card-body">
                <img
                  class="cover"
                  src="${responseData.image}"
                  alt=""
                  style="width: 100%"
                  height="350px"
                />
                <h6 class="mt-1">${responseData.created_at}</h6>
                <h5>${responseData.title || ""}</h5>
                <p>
                ${responseData.body || "This post has no description."}
                </p>
                <hr />
                <!-- comments section -->
                <div id="CommentHere">
                 
                </div>
                
              </div>
            </div>
          `;
        document.getElementById("postcard").innerHTML = content;
        console.log(responseData.comments);
        fillComments(responseData.comments);
      }
      function fillComments(comments) {
        const commentsSection = document.getElementById("CommentHere");
        for (comment of comments) {
          let commentContent = `<div class="align-items-center mt-2 justify-content-center">
                        <div>
                          <div
                            style="width: 100%; color: black;
                            display: flex;
                            align-items: center;
                            padding: 10px 8px;
                            border-radius:0px 50px 50px 0px;
                            background-color: #cccccc;
                            "
                            class="gap-3 justify-content-space-evenly"
      
                          >
                            <img
                              class="rounded-circle border border-2"
                              style="width: 60px ;height:60px;align-self: self-start;"
                              
                              src="${comment.author.profile_image ||'https://static.vecteezy.com/system/resources/thumbnails/020/765/399/small/default-profile-account-unknown-icon-black-silhouette-free-vector.jpg'}"
                              alt=""
                            />
                            <div class="col-9">
                              <h3>@${comment.author.username}</h3>
                              <h5>${comment.body|| "there is no body"}</h5>
                    
                              
                            </div>
                          </div>
                         
                        </div>
                      </div>`;
          commentsSection.innerHTML += commentContent;
        }
      }
    </script>
  </body>
</html>
